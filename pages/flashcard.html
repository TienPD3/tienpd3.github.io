<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashcard Học Tập</title>
  <link rel="icon" href="/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-container {
      perspective: 1000px;
      width: 100%;
      height: 420px;
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .card-container.flipped .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2.5rem;
      background: #ffffff;
      color: #0f172a;
      border: 1px solid #e5e7eb;
    }
    
    .card-front { transform: rotateY(0deg); }
    .card-back { transform: rotateY(180deg); }
    
    .card-clickable {
      cursor: pointer;
    }
  </style>
</head>

<body class="bg-white min-h-screen">
  <div class="container mx-auto px-4 py-6 max-w-3xl">
    <!-- Header -->
    <header class="text-center mb-6">
      <h1 class="text-2xl font-semibold text-gray-800 mb-1">Flashcard</h1>
      <p class="text-gray-500 text-sm">Chọn bộ để bắt đầu học</p>
    </header>

    <!-- Simple counter -->
    <div class="text-center mb-4 text-gray-700 text-base">
      <span id="currentCard">1</span> / <span id="totalCards">0</span>
    </div>

    <!-- Card Container -->
    <div class="card-container mx-auto mb-8" id="cardContainer">
      <div class="card-inner">
        <!-- Front of Card -->
        <div class="card-front card-clickable">
          <div class="text-center relative w-full h-full flex items-center justify-center">
            <div class="absolute top-3 left-3 text-xs md:text-sm text-slate-500" id="cardHint">Get a hint</div>
            <h2 class="text-3xl md:text-4xl font-semibold leading-normal max-w-3xl" id="cardQuestion">Chọn bộ flashcard để bắt đầu</h2>
          </div>
        </div>
        
        <!-- Back of Card -->
        <div class="card-back card-clickable">
          <div class="text-center relative w-full h-full flex items-center justify-center">
            <div class="absolute top-3 left-3 text-xs md:text-sm text-slate-500">Answer</div>
            <div class="max-w-3xl">
              <h2 class="text-3xl md:text-4xl font-semibold leading-normal mb-2" id="cardAnswer">Đáp án</h2>
              <p class="text-base md:text-lg text-slate-600" id="cardExplanation">Giải thích chi tiết</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="flex items-center justify-center gap-4 mb-6">
      <button id="prevBtn" class="hidden px-4 py-2 text-sm md:text-base border border-slate-300 hover:bg-slate-50 text-slate-700 font-medium rounded-md transition-colors">
        Trước
      </button>
      
      <button id="flipBtn" class="hidden px-4 py-2 text-sm md:text-base bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors">Lật thẻ</button>
      
      <button id="nextBtn" class="hidden px-4 py-2 text-sm md:text-base border border-slate-300 hover:bg-slate-50 text-slate-700 font-medium rounded-md transition-colors">
        Tiếp theo
      </button>
      
      <button id="restartBtn" class="hidden px-4 py-2 text-sm md:text-base border border-slate-300 hover:bg-slate-50 text-slate-700 font-medium rounded-md transition-colors">Bắt đầu lại</button>
    </div>

    <!-- Flashcard Sets -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="flashcardSets">
      <!-- Flashcard sets will be loaded here -->
    </div>
  </div>

  <script>
    // Simple Flashcard App
    class FlashcardApp {
      constructor() {
        this.currentSet = null;
        this.currentIndex = 0;
        this.isFlipped = false;
        
        // DOM Elements
        this.cardContainer = document.getElementById('cardContainer');
        this.cardQuestion = document.getElementById('cardQuestion');
        this.cardAnswer = document.getElementById('cardAnswer');
        this.cardHint = document.getElementById('cardHint');
        this.cardExplanation = document.getElementById('cardExplanation');
        this.currentCardEl = document.getElementById('currentCard');
        this.totalCardsEl = document.getElementById('totalCards');
        this.prevBtn = document.getElementById('prevBtn');
        this.flipBtn = document.getElementById('flipBtn');
        this.nextBtn = document.getElementById('nextBtn');
        this.restartBtn = document.getElementById('restartBtn');
        this.flashcardSets = document.getElementById('flashcardSets');
        
        // Flashcard Data
        this.flashcardData = {
          'japanese-n5': {
            title: 'Tiếng Nhật N5',
            color: 'from-blue-500 to-cyan-500',
            cards: [
              { question: 'こんにちは', answer: 'Xin chào', explanation: 'Cách chào hỏi thông thường' },
              { question: 'ありがとう', answer: 'Cảm ơn', explanation: 'Cách nói cảm ơn' },
              { question: 'すみません', answer: 'Xin lỗi', explanation: 'Cách xin lỗi' },
              { question: 'はい', answer: 'Có / Vâng', explanation: 'Cách trả lời khẳng định' },
              { question: 'いいえ', answer: 'Không', explanation: 'Cách trả lời phủ định' }
            ]
          },
          'english-basic': {
            title: 'Tiếng Anh Cơ Bản',
            color: 'from-green-500 to-emerald-500',
            cards: [
              { question: 'Hello', answer: 'Xin chào', explanation: 'Lời chào thông thường' },
              { question: 'Thank you', answer: 'Cảm ơn', explanation: 'Cách nói cảm ơn' },
              { question: 'Please', answer: 'Làm ơn', explanation: 'Từ lịch sự khi yêu cầu' },
              { question: 'Sorry', answer: 'Xin lỗi', explanation: 'Cách xin lỗi' },
              { question: 'Goodbye', answer: 'Tạm biệt', explanation: 'Lời chào tạm biệt' }
            ]
          },
          'math-basic': {
            title: 'Toán Học Cơ Bản',
            color: 'from-purple-500 to-pink-500',
            cards: [
              { question: '2 + 2 = ?', answer: '4', explanation: 'Phép cộng cơ bản' },
              { question: '5 × 3 = ?', answer: '15', explanation: 'Phép nhân' },
              { question: '10 ÷ 2 = ?', answer: '5', explanation: 'Phép chia' },
              { question: '3² = ?', answer: '9', explanation: 'Lũy thừa' },
              { question: '√16 = ?', answer: '4', explanation: 'Căn bậc hai' }
            ]
          },
          'kanji-n4': {
            title: 'Kanji N4',
            color: 'from-rose-500 to-pink-500',
            cards: [] // will be loaded dynamically
          }
        };
        
        this.init();
      }
      
      init() {
        this.renderFlashcardSets();
        this.setupEventListeners();
      }
      
      renderFlashcardSets() {
        this.flashcardSets.innerHTML = '';
        
        Object.entries(this.flashcardData).forEach(([key, set]) => {
          const setElement = document.createElement('div');
          setElement.className = `bg-gradient-to-br ${set.color} p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 cursor-pointer`;
          setElement.innerHTML = `
            <div class="text-center text-white">
              <h4 class="text-xl font-bold mb-2">${set.title}</h4>
              <p class="text-sm opacity-90">${set.cards.length} thẻ</p>
            </div>
          `;
          
          setElement.addEventListener('click', async () => {
            if (key === 'kanji-n4' && this.flashcardData['kanji-n4'].cards.length === 0) {
              await this.loadKanjiN4FromJson();
            }
            this.startFlashcardSet(key);
          });
          this.flashcardSets.appendChild(setElement);
        });
      }
      
      startFlashcardSet(setKey) {
        this.currentSet = this.flashcardData[setKey];
        this.currentIndex = 0;
        this.isFlipped = false;
        
        // Hide sets, show controls
        this.flashcardSets.style.display = 'none';
        this.prevBtn.classList.remove('hidden');
        this.flipBtn.classList.remove('hidden');
        this.nextBtn.classList.remove('hidden');
        this.restartBtn.classList.remove('hidden');
        
        // Update UI
        this.updateCard();
        this.updateProgress();
      }
      
      updateCard() {
        if (!this.currentSet) return;
        
        const card = this.currentSet.cards[this.currentIndex];
        
        if (!this.isFlipped) {
          this.cardQuestion.textContent = card.question;
          this.cardHint.textContent = 'Click vào thẻ để xem đáp án';
          this.cardContainer.classList.remove('flipped');
        } else {
          this.cardAnswer.textContent = card.answer;
          this.cardExplanation.textContent = card.explanation;
          this.cardContainer.classList.add('flipped');
        }
      }
      
      updateProgress() {
        if (!this.currentSet) return;
        
        this.currentCardEl.textContent = this.currentIndex + 1;
        this.totalCardsEl.textContent = this.currentSet.cards.length;
        
        // Progress bar removed for simplified UI
      }
      
      flipCard() {
        this.isFlipped = !this.isFlipped;
        this.updateCard();
      }
      
      nextCard() {
        if (this.currentIndex < this.currentSet.cards.length - 1) {
          this.currentIndex++;
          this.isFlipped = false;
          this.updateCard();
          this.updateProgress();
        } else {
          this.showCompletion();
        }
      }
      
      previousCard() {
        if (this.currentIndex > 0) {
          this.currentIndex--;
          this.isFlipped = false;
          this.updateCard();
          this.updateProgress();
        }
      }
      
      showCompletion() {
        this.cardContainer.innerHTML = `
          <div class="bg-gradient-to-br from-green-500 to-emerald-500 text-white shadow-xl rounded-xl p-8 text-center">
            <div class="text-6xl mb-4">🎉</div>
            <h2 class="text-3xl font-bold mb-4">Hoàn thành!</h2>
            <p class="text-lg opacity-90">Bạn đã học xong tất cả ${this.currentSet.cards.length} thẻ</p>
          </div>
        `;
        
        this.prevBtn.classList.add('hidden');
        this.flipBtn.classList.add('hidden');
        this.nextBtn.classList.add('hidden');
      }
      
      restart() {
        this.currentIndex = 0;
        this.isFlipped = false;
        
        // Show sets again
        this.flashcardSets.style.display = 'grid';
        this.prevBtn.classList.add('hidden');
        this.flipBtn.classList.add('hidden');
        this.nextBtn.classList.add('hidden');
        this.restartBtn.classList.add('hidden');
        
        // Reset card display
        this.cardContainer.innerHTML = `
          <div class="card-inner">
            <div class="card-front card-clickable">
              <div class="text-center">
                <div class="text-6xl mb-4">📚</div>
                <h2 class="text-3xl font-bold mb-4">Chọn bộ flashcard để bắt đầu</h2>
                <p class="text-lg opacity-90">Nhấn vào bộ flashcard bên dưới để bắt đầu học</p>
              </div>
            </div>
          </div>
        `;
        
        this.updateProgress();
      }
      
      setupEventListeners() {
        this.prevBtn.addEventListener('click', () => this.previousCard());
        this.flipBtn.addEventListener('click', () => this.flipCard());
        this.nextBtn.addEventListener('click', () => this.nextCard());
        this.restartBtn.addEventListener('click', () => this.restart());
        
        // Card click to flip
        this.cardContainer.addEventListener('click', () => {
          if (this.currentSet) {
            this.flipCard();
          }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (this.currentSet) {
            switch(e.key) {
              case 'ArrowRight':
                e.preventDefault();
                this.nextCard();
                break;
              case 'ArrowLeft':
                e.preventDefault();
                this.previousCard();
                break;
              case 'ArrowUp':
              case 'ArrowDown':
                e.preventDefault();
                this.flipCard();
                break;
            }
          }
        });
      }

      async loadKanjiN4FromJson() {
        try {
          const res = await fetch('/assets/storage/japan/n4/kanji-n4.json');
          const lessons = await res.json();
          const cards = [];
          for (const lesson of lessons) {
            const lessonName = lesson.lesson || '';
            for (const item of (lesson.kanji_list || [])) {
              const kanji = item.kanji || '';
              const vn = item.vietnamese_origin || '';
              if (kanji && vn) {
                cards.push({
                  question: kanji,
                  answer: vn,
                  explanation: lessonName,
                  emoji: '🈷️'
                });
              }
            }
          }
          this.flashcardData['kanji-n4'].cards = cards;
        } catch (e) {
          console.error('Failed to load Kanji N4 JSON', e);
          alert('Không tải được dữ liệu Kanji N4');
        }
      }
    }
    
    // Start the app
    new FlashcardApp();
  </script>
</body>
</html>